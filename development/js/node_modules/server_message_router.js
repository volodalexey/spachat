var Server_chats_collection = require('./server_chats_collection');
var Server_message_router = function(options) {
    this.server_chats_collection = new Server_chats_collection();
    this.msgMap = {
        create: this.server_chats_collection.onCreateChat,
        chat_join: this.server_chats_collection.onDeviceChatJoin,
        chat_offer: this.server_chats_collection.onDeviceChatOffer,
        answer: this.server_chats_collection.onAnswer,
        accept: this.server_chats_collection.onAccept
    };
};

Server_message_router.prototype = {

    __class_name: "server_message_router",

    onMessage: function(webSocketConnection, messageData) {
        var _this = this;
        try {
            var parsedMessageData = JSON.parse(messageData);
        } catch (e) {
            console.log(e);
            return;
        }

        var handler = _this.msgMap[parsedMessageData.type];
        console.log('Received message type => ', parsedMessageData.type);
        if (handler) {
            handler.call(_this.server_chats_collection, webSocketConnection, parsedMessageData);
        }
    }
};

module.exports = Server_message_router;